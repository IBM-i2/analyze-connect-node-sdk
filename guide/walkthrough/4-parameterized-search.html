<!DOCTYPE html>
<!--[if IE]><![endif]-->
<html>
  
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <title>Parameterized search </title>
    <meta name="viewport" content="width=device-width">
    <meta name="title" content="Parameterized search ">
    <meta name="generator" content="docfx 2.57.2.0">
    
    <link rel="shortcut icon" href="../../guide/favicon.png">
    <link rel="stylesheet" href="../../styles/docfx.vendor.css">
    <link rel="stylesheet" href="../../styles/docfx.css">
    <link rel="stylesheet" href="../../styles/main.css">
    <meta property="docfx:navrel" content="../../toc.html">
    <meta property="docfx:tocrel" content="../toc.html">
    
    <meta property="docfx:rel" content="../../">
    
  </head>
  <body data-spy="scroll" data-target="#affix" data-offset="120">
    <div id="wrapper">
      <header>
        
        <nav id="autocollapse" class="navbar navbar-inverse ng-scope" role="navigation">
          <div class="container">
            <div class="navbar-header">
              <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#navbar">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
              </button>
              
              <a class="navbar-brand" href="../../index.html">
                i2 <strong>Connect SDK</strong>
              </a>
            </div>
            <div class="collapse navbar-collapse" id="navbar">
              <form class="navbar-form navbar-right" role="search" id="search">
                <div class="form-group">
                  <input type="text" class="form-control" id="search-query" placeholder="Search" autocomplete="off">
                </div>
              </form>
            </div>
          </div>
        </nav>
      </header>
      <div class="container body-content">
        
        <div id="search-results">
          <div class="search-list">Search results for <span></span></div>
          <div class="sr-items">
            <p><i class="glyphicon glyphicon-refresh index-loading"></i></p>
          </div>
          <ul id="pagination" data-first="First" data-prev="Previous" data-next="Next" data-last="Last"></ul>
        </div>
      </div>
      <div role="main" class="container body-content hide-when-search">
        
        <div class="sidenav hide-when-search">
          <a class="btn toc-toggle collapse" data-toggle="collapse" href="#sidetoggle" aria-expanded="false" aria-controls="sidetoggle">Show/hide table of contents</a>
          <div class="sidetoggle collapse" id="sidetoggle">
            <div id="sidetoc"></div>
          </div>
        </div>
        <div class="article row grid-right">
          <div class="col-md-10">
          
          <div class="subnav navbar navbar-default">
            <div class="container hide-when-search" id="breadcrumb">
              <ul class="breadcrumb">
                <li></li>
              </ul>
            </div>
          </div>
            <article class="content wrap" id="_content" data-uid="">
<h1 id="parameterized-search">Parameterized search</h1>

<p>A parameterized search enables users to pass conditions in their requests that you can use to change the behavior of your searches.</p>
<p>If you have any problems during this task, remember to consult the
<a href="../miscellaneous/troubleshoot.html">troubleshooting guide</a>.</p>
<h2 id="configuration">Configuration</h2>
<p>To explore parameterized searching, you&#39;ll start by adding a new service to the connector.</p>
<h3 id="add-a-new-service">Add a new service</h3>
<p>Add another service to your <code>index.ts</code> file, and provide a <a href="https://i2group.github.io/analyze-connect-node-sdk/api/i2connect.services.iserviceconfig.html">form configuration</a>. The form allows you to specify conditions through fields that are displayed to users in Analyst&#39;s Notebook, for example.</p>
<pre><code class="lang-ts">addService(
  {
    id: &#39;findComplaint&#39;,
    name: &#39;NYPD Connector: Search&#39;,
    description: &#39;A service for conditional searches.&#39;,
    form: {
      borough: {
        label: &#39;Borough name&#39;,
        logicalType: &#39;selectedFromList&#39;,
        isMandatory: true,
        possibleValues: [],
      },
      lawCategory: {
        label: &#39;Law category&#39;,
        logicalType: &#39;selectedFromList&#39;,
        isMandatory: true,
        possibleValues: [],
      },
    },
  },
  () =&gt; {
    // TODO: Implement the service
  }
);
</code></pre><p><strong>Note:</strong> This form contains two mandatory fields, which means that users are forced to open it and provide values before they can run the service. If there are no mandatory fields but you still want users to see the form, you can use the <code>formIsMandatory</code> property to make the form itself mandatory. For more information, see <a href="7-validation.html">Validation</a>.</p>
<h2 id="implementation">Implementation</h2>
<p>With the service defined, you can implement it to search the NYPD data source using the form conditions. You need to:</p>
<ol>
<li><p>Parse the conditions to the <code>acquire</code> part of the service, defining both <code>borough</code> and <code>lawCategory</code> conditions.</p>
</li>
<li><p>Use those conditions to query the NYPD data source.</p>
</li>
<li><p>Filter the NYPD data source based on those conditions. You can use the condition fields to determine which of the entities retrieved from the data source match the parameters given by the user in the form.</p>
</li>
<li><p>Create and return Complaint entities based on the matched conditions.</p>
</li>
</ol>
<p>For example:</p>
<pre><code class="lang-ts">addService(
  {
    id: &#39;findComplaint&#39;,
    name: &#39;NYPD Connector: Search&#39;,
    description: &#39;A service for conditional searches.&#39;,
    form: {
      borough: {
        label: &#39;Borough name&#39;,
        logicalType: &#39;selectedFromList&#39;,
        isMandatory: true,
        possibleValues: [
          { displayValue: &#39;Brooklyn&#39;, value: &#39;BROOKLYN&#39; },
          { displayValue: &#39;Bronx&#39;, value: &#39;BRONX&#39; },
          { displayValue: &#39;Manhattan&#39;, value: &#39;MANHATTAN&#39; },
          { displayValue: &#39;Queens&#39;, value: &#39;QUEENS&#39; },
          { displayValue: &#39;Staten Island&#39;, value: &#39;STATEN ISLAND&#39; },
        ],
      },
      lawCategory: {
        label: &#39;Law category&#39;,
        logicalType: &#39;selectedFromList&#39;,
        isMandatory: true,
        possibleValues: [
          { displayValue: &#39;Felony&#39;, value: &#39;FELONY&#39; },
          { displayValue: &#39;Misdemeanor&#39;, value: &#39;MISDEMEANOR&#39; },
          { displayValue: &#39;Violation&#39;, value: &#39;VIOLATION&#39; },
        ],
      },
    },
  },
  async ({ conditions: { borough, lawCategory }, result }) =&gt; {
    const data = await requestData({
      $limit: &#39;50&#39;,
      $where: `boro_nm=&quot;${borough}&quot; AND law_cat_cd=&quot;${lawCategory}&quot;`,
    });

    for (const datum of data) {
      addComplaint(datum, result);
    }
  }
);
</code></pre><h2 id="reload-the-connector-configuration-in-i2-analyze">Reload the connector configuration in i2 Analyze</h2>
<p>To make the new service available, you must reload the connector so that i2 Analyze picks up the configuration changes. Just like when you deployed the connector for the first time, you can use the Admin Console.</p>
<ol>
<li><p>Open a web browser and navigate to <a href="https://i2analyze.eia:9443/opal/admin#/connectors"><code>https://i2analyze.eia:9443/opal/admin#/connectors</code></a>.</p>
</li>
<li><p>If you are prompted to log in, enter <code>Jenny</code> and <code>Jenny</code> as the username and password.</p>
</li>
<li><p>Click the <strong>Reload gateway</strong> button.</p>
</li>
</ol>
<h2 id="investigate-in-analysts-notebook">Investigate in Analyst&#39;s Notebook</h2>
<p>Now you can see what happens when you use the connector from the Analyst&#39;s Notebook desktop client.</p>
<ol>
<li><p>Open Analyst&#39;s Notebook and log in when prompted.</p>
</li>
<li><p>Click the <strong>External Searches</strong> button in the ribbon bar. You should see the service named <strong>NYPD Connector: Search</strong>.</p>
</li>
<li><p>Click <strong>Open</strong> to display the search form.</p>
</li>
<li><p>Provide values for the two conditions, and then click <strong>Run</strong> to send the parameters to the service, which queries the data source and returns results.</p>
</li>
</ol>
<h2 id="next-steps">Next steps</h2>
<p>Now you can implement <a href="5-seeded-search.html">seeded searches</a>.</p>
</article>
          </div>
          
          <div class="hidden-sm col-md-2" role="complementary">
            <div class="sideaffix">
              <nav class="bs-docs-sidebar hidden-print hidden-xs hidden-sm affix" id="affix">
                <h5>In this article</h5>
                <div></div>
              </nav>
            </div>
          </div>
        </div>
      </div>
      
      <footer>
        <div class="grad-bottom"></div>
        <div class="footer">
          <div class="container">
            <span class="pull-right">
              <a href="#top">Back to top</a>
            </span>
            &copy; N. Harris Computer Corporation
            
          </div>
        </div>
      </footer>
    </div>
    
    <script type="text/javascript" src="../../styles/docfx.vendor.js"></script>
    <script type="text/javascript" src="../../styles/docfx.js"></script>
    <script type="text/javascript" src="../../styles/main.js"></script>
  </body>
</html>
