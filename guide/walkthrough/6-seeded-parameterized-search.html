<!DOCTYPE html>
<!--[if IE]><![endif]-->
<html>
  
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <title>Seeded, parameterized search </title>
    <meta name="viewport" content="width=device-width">
    <meta name="title" content="Seeded, parameterized search ">
    <meta name="generator" content="docfx 2.57.2.0">
    
    <link rel="shortcut icon" href="../../guide/favicon.png">
    <link rel="stylesheet" href="../../styles/docfx.vendor.css">
    <link rel="stylesheet" href="../../styles/docfx.css">
    <link rel="stylesheet" href="../../styles/main.css">
    <meta property="docfx:navrel" content="../../toc.html">
    <meta property="docfx:tocrel" content="../toc.html">
    
    <meta property="docfx:rel" content="../../">
    
  </head>
  <body data-spy="scroll" data-target="#affix" data-offset="120">
    <div id="wrapper">
      <header>
        
        <nav id="autocollapse" class="navbar navbar-inverse ng-scope" role="navigation">
          <div class="container">
            <div class="navbar-header">
              <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#navbar">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
              </button>
              
              <a class="navbar-brand" href="../../index.html">
                i2 <strong>Connect SDK</strong>
              </a>
            </div>
            <div class="collapse navbar-collapse" id="navbar">
              <form class="navbar-form navbar-right" role="search" id="search">
                <div class="form-group">
                  <input type="text" class="form-control" id="search-query" placeholder="Search" autocomplete="off">
                </div>
              </form>
            </div>
          </div>
        </nav>
      </header>
      <div class="container body-content">
        
        <div id="search-results">
          <div class="search-list">Search results for <span></span></div>
          <div class="sr-items">
            <p><i class="glyphicon glyphicon-refresh index-loading"></i></p>
          </div>
          <ul id="pagination" data-first="First" data-prev="Previous" data-next="Next" data-last="Last"></ul>
        </div>
      </div>
      <div role="main" class="container body-content hide-when-search">
        
        <div class="sidenav hide-when-search">
          <a class="btn toc-toggle collapse" data-toggle="collapse" href="#sidetoggle" aria-expanded="false" aria-controls="sidetoggle">Show/hide table of contents</a>
          <div class="sidetoggle collapse" id="sidetoggle">
            <div id="sidetoc"></div>
          </div>
        </div>
        <div class="article row grid-right">
          <div class="col-md-10">
          
          <div class="subnav navbar navbar-default">
            <div class="container hide-when-search" id="breadcrumb">
              <ul class="breadcrumb">
                <li></li>
              </ul>
            </div>
          </div>
            <article class="content wrap" id="_content" data-uid="">
<h1 id="seeded-parameterized-search">Seeded, parameterized search</h1>

<p>A seeded, parameterized search is a combination of seeded and parameterized searches. This type of search passes information from an entity on the chart to the service, together with conditions that can change the behavior of your searches.</p>
<p>If you have any issues during this task, remember to consult the
<a href="../miscellaneous/troubleshoot.html">troubleshooting guide</a>.</p>
<h2 id="configuration">Configuration</h2>
<p>To explore seeded, parameterized searches, you&#39;ll start by adding another new service to the connector.</p>
<h3 id="add-a-new-service">Add a new service</h3>
<p>The new service in this example requires both a <code>form</code> setting and a <code>seedConstraints</code> setting. For more information, see the documentation for the <a href="https://i2group.github.io/analyze-connect-node-sdk/api/i2connect.services.iserviceconfig.html"><code>IServiceConfig</code> interface</a>, or go over the last two steps of the walkthrough.</p>
<p>For example:</p>
<pre><code class="lang-ts">{
  addService(
    {
      id: &#39;expandWithConditions&#39;,
      name: &#39;NYPD Connector: Expand with conditions&#39;,
      description: &#39;A service that executes an expand operation on a seed, with conditions.&#39;,
      seedConstraints: { typeConstraints: [Complaint], min: 1, max: 1 },
      form: {
        isPerson: { label: &#39;Person&#39;, logicalType: &#39;boolean&#39; },
      },
    },
    () =&gt; {
      // TODO: Implement the service
    }
  );
}
</code></pre><h2 id="implementation">Implementation</h2>
<p>With the service defined, you can implement it to search the NYPD data source. You need to:</p>
<ol>
<li><p>Parse the seeds to the <code>acquire</code> part of the service.</p>
</li>
<li><p>Access the condition, and use it and the seeds to query the NYPD data source.</p>
</li>
<li><p>Filter the NYPD data source based on the conditions and the seeds. How you use the seeds depends on what you are trying to achieve.</p>
</li>
</ol>
<h3 id="filter-data-based-on-conditions-and-seeds">Filter data based on conditions and seeds</h3>
<p>An &quot;expand with conditions&quot; query takes an entity as a seed and returns a list of entities and links that:</p>
<ul>
<li>are connected to the seed, and</li>
<li>satisfy the list of conditions that the user provided.</li>
</ul>
<p>For this service, you need to query the NYPD data source to find entities that are related to the seed entity. Then, you filter those results according to the <code>conditions</code>. Finally, you fabricate link records that represent the relationships. Every link record that you create must have the seed record at one of its ends.</p>
<pre><code class="lang-ts">addService(
  {
    id: &#39;expandWithConditions&#39;,
    name: &#39;NYPD Connector: Expand with conditions&#39;,
    description: &#39;A service that executes an expand operation on a seed, with conditions.&#39;,
    seedConstraints: { typeConstraints: [Complaint], min: 1, max: 1 },
    form: {
      isPerson: { label: &#39;Person&#39;, logicalType: &#39;boolean&#39; },
    },
  },
  async ({ conditions: { isPerson }, seeds, result }) =&gt; {
    const seed = seeds.entities[0];
    const complaintNumber = (seed.isType(Complaint) &amp;&amp; seed.getProperty(&#39;Complaint Number&#39;)) || &#39;&#39;;

    const data = await requestData({
      $limit: &#39;50&#39;,
      $where: `cmplnt_num=&quot;${complaintNumber}&quot;`,
    });

    const seedEntity = result.addEntityFromSeed(seed);

    for (const datum of data) {
      if (isPerson) {
        const suspectEntity = addSuspect(datum, result);
        const victimEntity = addVictim(datum, result);

        addLink(Suspectof, datum.cmplnt_num, suspectEntity, seedEntity, result);
        addLink(Victimof, datum.cmplnt_num, victimEntity, seedEntity, result);
      }

      const locationEntity = addLocation(datum, result);
      addLink(Locatedat, datum.cmplnt_num, seedEntity, locationEntity, result);
    }
  }
);
</code></pre><h2 id="reload-the-connector-configuration-in-i2-analyze">Reload the connector configuration in i2 Analyze</h2>
<p>To make the new service available, you must reload the connector so that i2 Analyze picks up the configuration changes. Just like when you deployed the connector for the first time, you can use the Admin Console.</p>
<ol>
<li><p>Open a web browser and navigate to <a href="https://i2analyze.eia:9443/opal/admin#/connectors"><code>https://i2analyze.eia:9443/opal/admin#/connectors</code></a>.</p>
</li>
<li><p>If you are prompted to log in, enter <code>Jenny</code> and <code>Jenny</code> as the username and password.</p>
</li>
<li><p>Click the <strong>Reload gateway</strong> button.</p>
</li>
</ol>
<h2 id="investigate-in-analysts-notebook">Investigate in Analyst&#39;s Notebook</h2>
<p>Now you can see what happens when you use the connector from the Analyst&#39;s Notebook desktop client.</p>
<ol>
<li><p>Open Analyst&#39;s Notebook and log in when prompted.</p>
</li>
<li><p>Select an entity that you retrieved from the NYPD data source on the chart.</p>
</li>
<li><p>Click the <strong>External Searches</strong> button in the ribbon. Find the query named <strong>NYPD Connector: Expand with conditions</strong>.</p>
</li>
<li><p>Click <strong>Open</strong> to display the search form.</p>
</li>
<li><p>Set the condition, and then click <strong>Run</strong> to send the parameter to the service, which queries the data source and returns results.</p>
</li>
</ol>
<h2 id="next-steps">Next steps</h2>
<p>Now that you&#39;ve completed this task, you can look into <a href="7-validation.html">validating service requests</a>.</p>
</article>
          </div>
          
          <div class="hidden-sm col-md-2" role="complementary">
            <div class="sideaffix">
              <nav class="bs-docs-sidebar hidden-print hidden-xs hidden-sm affix" id="affix">
                <h5>In this article</h5>
                <div></div>
              </nav>
            </div>
          </div>
        </div>
      </div>
      
      <footer>
        <div class="grad-bottom"></div>
        <div class="footer">
          <div class="container">
            <span class="pull-right">
              <a href="#top">Back to top</a>
            </span>
            &copy; N. Harris Computer Corporation
            
          </div>
        </div>
      </footer>
    </div>
    
    <script type="text/javascript" src="../../styles/docfx.vendor.js"></script>
    <script type="text/javascript" src="../../styles/docfx.js"></script>
    <script type="text/javascript" src="../../styles/main.js"></script>
  </body>
</html>
