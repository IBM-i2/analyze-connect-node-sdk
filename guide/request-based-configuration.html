<!DOCTYPE html>
<!--[if IE]><![endif]-->
<html>
  
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <title>Tailoring services based on request information </title>
    <meta name="viewport" content="width=device-width">
    <meta name="title" content="Tailoring services based on request information ">
    <meta name="generator" content="docfx 2.57.2.0">
    
    <link rel="shortcut icon" href="../guide/favicon.png">
    <link rel="stylesheet" href="../styles/docfx.vendor.css">
    <link rel="stylesheet" href="../styles/docfx.css">
    <link rel="stylesheet" href="../styles/main.css">
    <meta property="docfx:navrel" content="../toc.html">
    <meta property="docfx:tocrel" content="toc.html">
    
    <meta property="docfx:rel" content="../">
    
  </head>
  <body data-spy="scroll" data-target="#affix" data-offset="120">
    <div id="wrapper">
      <header>
        
        <nav id="autocollapse" class="navbar navbar-inverse ng-scope" role="navigation">
          <div class="container">
            <div class="navbar-header">
              <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#navbar">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
              </button>
              
              <a class="navbar-brand" href="../index.html">
                i2 <strong>Connect SDK</strong>
              </a>
            </div>
            <div class="collapse navbar-collapse" id="navbar">
              <form class="navbar-form navbar-right" role="search" id="search">
                <div class="form-group">
                  <input type="text" class="form-control" id="search-query" placeholder="Search" autocomplete="off">
                </div>
              </form>
            </div>
          </div>
        </nav>
      </header>
      <div class="container body-content">
        
        <div id="search-results">
          <div class="search-list">Search results for <span></span></div>
          <div class="sr-items">
            <p><i class="glyphicon glyphicon-refresh index-loading"></i></p>
          </div>
          <ul id="pagination" data-first="First" data-prev="Previous" data-next="Next" data-last="Last"></ul>
        </div>
      </div>
      <div role="main" class="container body-content hide-when-search">
        
        <div class="sidenav hide-when-search">
          <a class="btn toc-toggle collapse" data-toggle="collapse" href="#sidetoggle" aria-expanded="false" aria-controls="sidetoggle">Show/hide table of contents</a>
          <div class="sidetoggle collapse" id="sidetoggle">
            <div id="sidetoc"></div>
          </div>
        </div>
        <div class="article row grid-right">
          <div class="col-md-10">
          
          <div class="subnav navbar navbar-default">
            <div class="container hide-when-search" id="breadcrumb">
              <ul class="breadcrumb">
                <li></li>
              </ul>
            </div>
          </div>
            <article class="content wrap" id="_content" data-uid="">
<h1 id="tailoring-services-based-on-request-information">Tailoring services based on request information</h1>

<p>When the i2 Connect gateway passes a request to your service on behalf of a user, you can customize your response based on information in the request. For example, if your service has a form associated with it, you might want some groups of users to have access to more options than others. You might even decide that some users should have no access to the service at all.</p>
<p>You can tailor the following aspects of a service based on the request:</p>
<ul>
<li>Service visibility</li>
<li>Service name and description</li>
<li>Form section title</li>
<li>Form section and condition visibility</li>
<li>Form condition label and description</li>
<li>Form condition default value</li>
<li>Form condition possible values for selected-from and suggested-from types</li>
</ul>
<h2 id="service-and-form-condition-visibility">Service and form condition visibility</h2>
<p>To prevent access to a service, to particular conditions, or to sections of a form, you can provide a callback that returns a Boolean value to the corresponding <code>hide</code> property.</p>
<p>In all cases, the callback receives the request information, which allows you to access the <code>user</code> property as well as the raw request header information through the <code>header</code>.</p>
<pre><code class="lang-typescript">import { addService, services } from &#39;@i2analyze/i2connect&#39;;

addService(
  {
    id: &#39;analystSpecificService&#39;,
    name: &#39;Only visible to analysts group&#39;,
    hide: (requestInfo: services.IRequestInformation) =&gt; {
      return !requestInfo.user.groups.includes(&#39;analyst&#39;);
    },
    form: {
      field1: {
        label: &#39;Standard field&#39;,
        logicalType: &#39;singleLineString&#39;,
      },
      field2: {
        label: &#39;Super user only field&#39;,
        logicalType: &#39;singleLineString&#39;,
        hide: (requestInfo: services.IRequestInformation) =&gt; {
          return !requestInfo.user.groups.includes(&#39;superUser&#39;);
        },
      },
    },
  },
  () =&gt; {
    // Acquire code goes here
  }
);
</code></pre><h2 id="label-and-description-content">Label and description content</h2>
<p>To tailor the name or description of a service, or the label or description of a form condition, or the title of a form section, you can provide a callback that returns a string for those fields instead of a plain string:</p>
<pre><code class="lang-typescript">import { addService, services } from &#39;@i2analyze/i2connect&#39;;

addService(
  {
    id: &#39;serviceId&#39;,
    name: (requestInfo: services.IRequestInformation) =&gt; {
      return requestInfo.user.groups.includes(&#39;analyst&#39;) ? &#39;Analyst service&#39; : &#39;Standard service&#39;;
    },
    description: (requestInfo: services.IRequestInformation) =&gt; {
      return requestInfo.user.groups.includes(&#39;analyst&#39;) ? &#39;Describe analyst-specific features&#39; : &#39;&#39;;
    },
    form: {
      field1: {
        label: (requestInfo: services.IRequestInformation) =&gt; {
          return requestInfo.user.groups.includes(&#39;analyst&#39;) ? &#39;Analyst label&#39; : &#39;Standard label&#39;;
        },
        logicalType: &#39;singleLineString&#39;,
      },
    },
  },
  () =&gt; {
    // Acquire code goes here
  }
);
</code></pre><h2 id="default-values">Default values</h2>
<p>To tailor a default value for a form condition, you can provide a callback that returns the appropriate value according to the logical type:</p>
<pre><code class="lang-typescript">import { addService, services } from &#39;@i2analyze/i2connect&#39;;

addService(
  {
    id: &#39;serviceId&#39;,
    name: &#39;service name&#39;,
    form: {
      field1: {
        label: &#39;Maximum&#39;,
        logicalType: &#39;integer&#39;,
        defaultValue: (requestInfo: services.IRequestInformation) =&gt; {
          return requestInfo.user.groups.includes(&#39;analyst&#39;) ? 10 : 5;
        },
      },
    },
  },
  () =&gt; {
    // Acquire code goes here
  }
);
</code></pre><h2 id="possible-values">Possible values</h2>
<p>To tailor the options that users see for selected-from and suggested-from conditions, you can provide a callback that returns the desired possible values:</p>
<pre><code class="lang-typescript">import { addService, services } from &#39;@i2analyze/i2connect&#39;;

addService(
  {
    id: &#39;serviceId&#39;,
    name: &#39;service name&#39;,
    form: {
      field1: {
        label: &#39;Choose&#39;,
        logicalType: &#39;selectedFromList&#39;,
        possibleValues: (requestInfo: services.IRequestInformation) =&gt; {
          return requestInfo.user.groups.includes(&#39;analyst&#39;)
            ? [
                { value: &#39;1&#39;, displayValue: &#39;one&#39; },
                { value: &#39;2&#39;, displayValue: &#39;two&#39; },
              ]
            : [
                { value: &#39;3&#39;, displayValue: &#39;three&#39; },
                { value: &#39;4&#39;, displayValue: &#39;four&#39; },
              ];
        },
      },
    },
  },
  () =&gt; {
    // Acquire code goes here
  }
);
</code></pre><h2 id="acquire-validate-and-authenticate-callbacks">Acquire, validate, and authenticate callbacks</h2>
<p>In case you need to tailor the behavior of your <code>acquire()</code>, <code>validate()</code>, and <code>authenticate()</code> callbacks, they also receive an <code>IRequestInformation</code> object:</p>
<pre><code class="lang-typescript">import { addService, services } from &#39;@i2analyze/i2connect&#39;;

addService(
  {
    id: &#39;serviceId&#39;,
    name: &#39;service name&#39;,
    authenticator: createAuthenticator(
      {
        id: &#39;requestInfoCheckingAuthenticator&#39;,
        description: &#39;&#39;,
        form: {
          searchTerm: {
            label: &#39;Search term&#39;,
            logicalType: &#39;singleLineString&#39;,
            isMandatory: true,
          },
        },
      },
      ({ requestInformation }) =&gt; {
        // Retrieve a token from a third-party source, using the user principal.
        const token = thirdPartyTokenGenerator(requestInformation.user.principal);
        return token;
      }
    ),
  },
  {
    acquire: async ({ requestInformation, conditions: { searchTerm }, result }) =&gt; {
      // If the user is an analyst, they can request more information.
      const data = await requestData({
        $limit: requestInformation.user.groups.includes(&#39;Analyst&#39;) ? &#39;100&#39; : &#39;50&#39;,
        $where: searchTerm,
      });

      for (const datum of data) {
        addComplaint(datum, result);
      }
    },
    validate: ({ requestInformation, conditions: { searchTerm } }) =&gt; {
      // If the user is not an analyst, they cannot do a wildcard search.
      if (!requestInformation.user.groups.includes(&#39;Analyst&#39;)) {
        if (searchTerm === &#39;*&#39;) {
          throw new DetailedError({ title: &#39;Wildcard search is not allowed.&#39; });
        }
      }
    },
  }
);
</code></pre></article>
          </div>
          
          <div class="hidden-sm col-md-2" role="complementary">
            <div class="sideaffix">
              <nav class="bs-docs-sidebar hidden-print hidden-xs hidden-sm affix" id="affix">
                <h5>In this article</h5>
                <div></div>
              </nav>
            </div>
          </div>
        </div>
      </div>
      
      <footer>
        <div class="grad-bottom"></div>
        <div class="footer">
          <div class="container">
            <span class="pull-right">
              <a href="#top">Back to top</a>
            </span>
            &copy; N. Harris Computer Corporation
            
          </div>
        </div>
      </footer>
    </div>
    
    <script type="text/javascript" src="../styles/docfx.vendor.js"></script>
    <script type="text/javascript" src="../styles/docfx.js"></script>
    <script type="text/javascript" src="../styles/main.js"></script>
  </body>
</html>
